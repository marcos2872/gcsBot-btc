# üìà gcsBot - Framework de Trading Quantitativo para BTC/USDT

![Python](https://img.shields.io/badge/Python-3.11+-blue.svg) ![Docker](https://img.shields.io/badge/Docker-Ready-blue?logo=docker) ![License](https://img.shields.io/badge/License-MIT-green.svg)

Um framework de ponta para pesquisa, valida√ß√£o e execu√ß√£o de estrat√©gias de trading algor√≠tmico no par BTC/USDT. Este projeto vai al√©m de um simples bot, oferecendo um pipeline completo de Machine Learning, desde a otimiza√ß√£o de estrat√©gias com dados hist√≥ricos at√© a opera√ß√£o aut√¥noma e adaptativa na Binance.

---

## üìã Tabela de Conte√∫dos

- [üåü Sobre o Projeto](#-sobre-o-projeto)
- [‚ú® Features de Destaque](#-features-de-destaque)
- [üß† A Filosofia do Bot: Como Ele Pensa?](#-a-filosofia-do-bot-como-ele-pensa)
- [‚öôÔ∏è Ecossistema do Bot: Como os M√≥dulos Interagem](#Ô∏è-ecossistema-do-bot-como-os-m√≥dulos-interagem)
- [üöÄ Guia de In√≠cio R√°pido](#-guia-de-in√≠cio-r√°pido)
  - [Pr√©-requisitos](#pr√©-requisitos)
  - [Instala√ß√£o](#instala√ß√£o)
- [üîß Configura√ß√£o do Ambiente (`.env`)](#-configura√ß√£o-do-ambiente-env)
- [‚ñ∂Ô∏è O Workflow Profissional: Como Usar](#Ô∏è-o-workflow-profissional-como-usar)
  - [Fase 1: Pesquisa e Otimiza√ß√£o (`optimize`)](#fase-1-pesquisa-e-otimiza√ß√£o-optimize)
  - [Fase 2: Valida√ß√£o Fora da Amostra (`backtest`)](#fase-2-valida√ß√£o-fora-da-amostra-backtest)
  - [Fase 3: Opera√ß√£o em Ambiente de Teste (`test`)](#fase-3-opera√ß√£o-em-ambiente-de-teste-test)
  - [Fase 4: Opera√ß√£o em Produ√ß√£o (`trade`)](#fase-4-opera√ß√£o-em-produ√ß√£o-trade)
  - [Comandos de Gerenciamento](#comandos-de-gerenciamento)
- [üìÇ Estrutura do Projeto](#-estrutura-do-projeto)
- [üìú Licen√ßa](#-licen√ßa)

---

## üåü Sobre o Projeto

Este reposit√≥rio cont√©m um sistema de trading algor√≠tmico completo, projetado para ser robusto, inteligente e metodologicamente correto. Diferente de bots baseados em regras fixas, o gcsBot utiliza um modelo de **Machine Learning (LightGBM)** para encontrar padr√µes preditivos e uma arquitetura sofisticada para se adaptar √†s din√¢micas do mercado.

O n√∫cleo do projeto √© um processo de **Walk-Forward Optimization (WFO)** que garante que a estrat√©gia seja constantemente reavaliada e otimizada em dados novos, evitando o overfitting e a estagna√ß√£o. O resultado √© um agente aut√¥nomo que n√£o apenas opera, mas aprende e se ajusta.

---

## ‚ú® Features de Destaque

- **üß† Intelig√™ncia Autoadaptativa:**

  - **Confian√ßa Din√¢mica:** O bot ajusta sua pr√≥pria "coragem" (`prediction_confidence`) com base em seus lucros e preju√≠zos recentes, tornando-se mais ousado em sequ√™ncias de vit√≥rias e mais cauteloso ap√≥s perdas.
  - **Risco Din√¢mico (Bet Sizing):** O tamanho de cada opera√ß√£o √© proporcional √† convic√ß√£o do modelo no sinal, arriscando mais em oportunidades de alta probabilidade.
  - **Otimiza√ß√£o da Personalidade:** O sistema utiliza `Optuna` para encontrar n√£o apenas os melhores par√¢metros de modelo, mas a melhor "personalidade" para o bot, incluindo seu apetite de risco e velocidade de aprendizado.

- **ü§ñ Metodologia de N√≠vel Profissional:**

  - **Valida√ß√£o Robusta (Train/Validate/Test):** O processo de otimiza√ß√£o utiliza uma metodologia rigorosa que impede o vazamento de dados do futuro (_look-ahead bias_), garantindo que os resultados dos testes sejam honestos.
  - **Rotulagem de 3 Classes (Buy/Sell/Hold):** O modelo aprende a identificar mercados laterais e a ficar de fora, reduzindo trades desnecess√°rios e focando em sinais de alta qualidade.
  - **An√°lise de Regime de Mercado:** O bot utiliza features de longo prazo (`SMA200`, `ATR`) para entender o contexto do mercado (tend√™ncia vs. lateralidade, alta vs. baixa volatilidade) antes de tomar decis√µes.

- **‚öôÔ∏è Engenharia de Ponta:**
  - **Backtest Realista:** Todas as simula√ß√µes incluem custos operacionais (taxas de `0.1%` e derrapagem de `0.05%`) para uma avalia√ß√£o de performance fiel √† realidade.
  - **Integra√ß√£o de Dados Macroecon√¥micos:** Utiliza a varia√ß√£o de indicadores como DXY (d√≥lar), VIX (volatilidade), Ouro e T√≠tulos de 10 anos para um contexto de mercado mais rico.
  - **Deployment com Docker:** Ambiente 100% conteinerizado para uma execu√ß√£o consistente e livre de problemas de depend√™ncias.
  - **Cache Inteligente e Modo Offline:** Processa e armazena dados para inicializa√ß√µes futuras quase instant√¢neas e permite rodar o modo de otimiza√ß√£o completamente offline.

---

## üß† A Filosofia do Bot: Como Ele Pensa?

A tomada de decis√£o do gcsBot segue uma hierarquia de intelig√™ncia em quatro etapas:

1.  **Contexto (O Cen√°rio):** Primeiro, o bot analisa o **regime de mercado**. "Estamos em uma tend√™ncia de alta ou de baixa? A volatilidade est√° alta ou baixa?" Isso √© feito atrav√©s das features de regime (`regime_tendencia`, `regime_volatilidade`).

2.  **Sinal (A Oportunidade):** Dentro desse contexto, o modelo de Machine Learning busca por um **padr√£o preditivo** de curto prazo, uma inefici√™ncia que sugira uma oportunidade de compra.

3.  **Convic√ß√£o (A Coragem):** Uma vez que um sinal √© encontrado, o bot consulta seu **n√≠vel de confian√ßa adaptativo**. "Baseado na minha performance recente, eu deveria arriscar neste sinal ou √© melhor ter paci√™ncia?"

4.  **A√ß√£o (O Tamanho da Posi√ß√£o):** Se a convic√ß√£o for alta o suficiente, o bot calcula o **tamanho do risco** a ser tomado, proporcional √† for√ßa do sinal. Um sinal "ok" recebe uma aloca√ß√£o pequena; um sinal "perfeito" recebe uma aloca√ß√£o maior.

Este processo transforma o bot de um simples executor de regras em um agente estrat√©gico que pensa em m√∫ltiplas camadas.

---

## ‚öôÔ∏è Ecossistema do Bot: Como os M√≥dulos Interagem

- **`optimizer.py`**: O c√©rebro da pesquisa. Gerencia o WFO, chama o `model_trainer` e o `backtest`, e usa o `Optuna` para encontrar os melhores par√¢metros.
- **`model_trainer.py`**: O "cientista de dados". Prepara todas as features (t√©cnicas, macro e de regime) e treina o modelo LightGBM.
- **`confidence_manager.py`**: O "psic√≥logo" do bot. Implementa a l√≥gica para ajustar a confian√ßa com base nos resultados.
- **`backtest.py`**: O simulador. Executa a estrat√©gia de forma realista, utilizando o `confidence_manager` para testar o desempenho da estrat√©gia adaptativa.
- **`quick_tester.py`**: O "auditor". Permite validar um modelo j√° treinado em um per√≠odo de tempo futuro completamente novo.
- **`trading_bot.py`**: O "piloto". M√≥dulo que opera no mercado real, utilizando os artefatos (`.pkl`, `.json`) gerados pela otimiza√ß√£o.

---

## üöÄ Guia de In√≠cio R√°pido

Siga estes passos para colocar o bot em funcionamento.

### Pr√©-requisitos

- [Python 3.11+](https://www.python.org/downloads/)
- [Git](https://git-scm.com/downloads)
- [Docker Desktop](https://www.docker.com/products/docker-desktop/) (em execu√ß√£o)

### Instala√ß√£o

1.  **Clone o reposit√≥rio:**
    ```bash
    git clone [https://github.com/SEU_USUARIO/gcsbot-btc.git](https://github.com/SEU_USUARIO/gcsbot-btc.git)
    cd gcsbot-btc
    ```
2.  **Execute o Setup Autom√°tico:**
    Este comando ir√° verificar o ambiente, instalar as depend√™ncias e criar o seu arquivo de configura√ß√£o `.env`.

    ```bash
    python run.py setup
    ```

    > ‚ö†Ô∏è **Aten√ß√£o:** Ap√≥s o setup, abra o arquivo `.env` rec√©m-criado e preencha **todas** as vari√°veis, especialmente suas chaves de API.

3.  **Construa a Imagem Docker:**
    ```bash
    python run.py build
    ```

---

## üîß Configura√ß√£o do Ambiente (`.env`)

O arquivo `.env` √© o painel de controle principal do bot.

- **`MODE`**: Modo de opera√ß√£o: `optimize`, `backtest`, `test`, ou `trade`.
- **`FORCE_OFFLINE_MODE`**: `True` ou `False`. Impede o bot de acessar a internet (√∫til para otimiza√ß√µes).

#### Chaves de API

- `BINANCE_API_KEY` & `BINANCE_API_SECRET`: Chaves da conta **real**.
- `BINANCE_TESTNET_API_KEY` & `BINANCE_TESTNET_API_SECRET`: Chaves da conta **Testnet**.

#### Gest√£o de Portf√≥lio (Para os modos `test` e `trade`)

- `MAX_USDT_ALLOCATION`: O **M√ÅXIMO** de capital em USDT que o bot tem permiss√£o para gerenciar.
- `LONG_TERM_HOLD_PCT`: Percentual do capital para holding de longo prazo (ex: `0.50` para 50%).

#### Par√¢metros de Backtest e Fallback

- `RISK_PER_TRADE_PCT`: **Fallback** do risco por opera√ß√£o, caso o valor n√£o seja encontrado nos par√¢metros otimizados.
- `BACKTEST_START_DATE` & `BACKTEST_END_DATE`: Per√≠odo para a simula√ß√£o do modo `backtest`.

> ‚ö†Ô∏è **NUNCA** envie seu arquivo `.env` para reposit√≥rios p√∫blicos! O `.gitignore` j√° est√° configurado para ignor√°-lo.

---

## ‚ñ∂Ô∏è Como Usar (Workflow Profissional)

A intera√ß√£o com o bot √© feita atrav√©s do orquestrador `run.py`. Siga estas fases na ordem correta.

### Fase 1: Otimiza√ß√£o

O passo mais importante. O bot ir√° estudar todo o hist√≥rico para encontrar a melhor estrat√©gia e criar os arquivos de modelo.

```bash
python run.py optimize
```

Este processo √© longo e pode levar horas ou dias. Ao final, os arquivos `trading_model.pkl`, `scaler.pkl` e `strategy_params.json` ser√£o salvos na pasta /data.

---

### Fase 2: Backtest R√°pido

Ap√≥s a otimiza√ß√£o, valide a estrat√©gia no mercado ao vivo com dinheiro de teste.

```bash
python run.py backtest
```

O bot ir√° rodar a simula√ß√£o no per√≠odo definido no .env e imprimir um relat√≥rio de performance m√™s a m√™s no terminal.

---

### Fase 3: Valida√ß√£o em Testnet

Ap√≥s a otimiza√ß√£o, valide a estrat√©gia no mercado ao vivo com dinheiro de teste.

```bash
python run.py test
```

O bot iniciar√° em segundo plano e rodar√° 24/7. Ele usar√° o modelo e os par√¢metros criados na Fase 1. Deixe rodando por pelo menos 1-2 semanas para obter dados estat√≠sticos relevantes.

---

### Fase 3: Trading Real

Ap√≥s a otimiza√ß√£o, valide a estrat√©gia no mercado ao vivo com dinheiro de teste.

```bash
python run.py trade
```

O bot operar√° da mesma forma que no modo test, mas utilizando sua conta real da Binance.

---

## Comandos Adicionais

- Ver os Logs em Tempo Real:

```bash
python run.py logs
```

- Parar o Bot (Modo `test` ou `trade`):

```bash
python run.py stop
```

---

# üìÇ Estrutura do Projeto

```bash
gcsbot-btc/
‚îú‚îÄ‚îÄ data/                  # Dados gerados (CSVs, modelos, estados) - Ignorado pelo Git
‚îú‚îÄ‚îÄ logs/                  # Arquivos de log di√°rios - Ignorado pelo Git
‚îú‚îÄ‚îÄ src/                   # C√≥digo fonte do projeto
‚îÇ   ‚îú‚îÄ‚îÄ __init__.py
‚îÇ   ‚îú‚îÄ‚îÄ backtest.py        # Motor de simula√ß√£o realista (usado pela otimiza√ß√£o)
‚îÇ   ‚îú‚îÄ‚îÄ config.py          # Gerenciador de configura√ß√µes do .env
‚îÇ   ‚îú‚îÄ‚îÄ confidence_manager.py # C√©rebro da confian√ßa adaptativa
‚îÇ   ‚îú‚îÄ‚îÄ data_manager.py    # Gerenciador de coleta e cache de dados
‚îÇ   ‚îú‚îÄ‚îÄ logger.py          # Configura√ß√£o do sistema de logs
‚îÇ   ‚îú‚îÄ‚îÄ model_trainer.py   # Prepara features e treina o modelo de ML
‚îÇ   ‚îú‚îÄ‚îÄ optimizer.py       # Orquestrador do Walk-Forward Optimization (WFO)
‚îÇ   ‚îú‚îÄ‚îÄ quick_tester.py    # L√≥gica para o modo de backtest r√°pido (valida√ß√£o)
‚îÇ   ‚îî‚îÄ‚îÄ trading_bot.py     # L√≥gica de opera√ß√£o real e gest√£o de portf√≥lio
‚îú‚îÄ‚îÄ .dockerignore          # Arquivos a serem ignorados pelo Docker
‚îú‚îÄ‚îÄ .env.example           # Exemplo do arquivo de configura√ß√£o
‚îú‚îÄ‚îÄ .gitignore             # Arquivos a serem ignorados pelo Git
‚îú‚îÄ‚îÄ Dockerfile             # Define o ambiente Docker para o bot
‚îú‚îÄ‚îÄ main.py                # Ponto de entrada principal (usado pelo Docker)
‚îú‚îÄ‚îÄ README.md              # Esta documenta√ß√£o
‚îú‚îÄ‚îÄ requirements.txt       # Depend√™ncias Python
‚îî‚îÄ‚îÄ run.py                 # Orquestrador principal e ponto de entrada do usu√°rio
```
